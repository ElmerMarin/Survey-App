@using Model;

@{
    ViewBag.Title = "GenerarEncuesta";
    SystemEncuestas db = new SystemEncuestas();
    List<Preguntas> preguntas = ViewBag.preguntas;
    List<int> RespuestaSeleccionada = ViewBag.respuestas;

    string fecha = "", horaInicio = "", IdUsuario = "";
    //moment().format('LTS');
    if (HttpContext.Current.Session["TipoUsuario"] == null)
    {
        Response.Redirect("~/Acceso/Login");
    }
    else
    {
        IdUsuario = HttpContext.Current.Session["Usuario_Id"].ToString();
        fecha = DateTime.Now.ToString("dd/MM/yyyy");
        horaInicio = DateTime.Now.ToString("dd/MM/yyyy");
        //horaInicio = DateTime.Now.ToString("hh:mm:ss tt");
    }

    int? IdEncuesta = ViewBag.idEncuesta;

    int TotalRespuestas = 0;
    int TotalPreguntas = 0;



}

<h2 class="u-text-center">Resultados Finales</h2>

@for (int i = 0; i < preguntas.Count; i++)
{
    TotalPreguntas++;
    int idpregunta = preguntas[i].Id;
    var respuestas = db.Respuestas.Where(p => p.IdPregunta == idpregunta).ToList();
    var contadorPregunta = "Grafica:" + i;

    <p class="u-text-bold" style="font-family:Arial;font-size:16px;"> @(i+1).@preguntas[i].Descripcion</p>
    <div class="row">
        <div class="col-xl-8">
            <div class="c-card u-p-medium u-mb-medium">
                <div class="u-flex u-justify-between u-align-items-center">
                    <h3 class="c-card__title">Preguntas</h3>
                    <span class="u-text-small u-text-uppercase u-text-mute">@DateTime.Now.Year</span>
                </div>
                <canvas id=@contadorPregunta width="300" height="155"></canvas>
            </div>
        </div>
    </div>
    for (int j = 0; j < respuestas.Count; j++)
    {
        TotalRespuestas++;
        string descripcion = respuestas[j].Descripcion;
        var RespuestasDeUsuarios = db.DetalleResultado.Where(p => p.IdEncuesta == IdEncuesta && p.Valor == descripcion).Count();
        <p style="font-family:Arial;font-size:14px;">@respuestas[j].Descripcion  @RespuestasDeUsuarios</p>

    }

    <script src='~/Content/js/utils.js'></script>
    <script src='~/Content/js/Chart.min.js'></script>
    <script>

            let canvas = document.getElementById("Grafica:0").getContext("2d");
            if (window.grafica) {
                window.grafica.clear();
                window.grafica.destroy();
            }


            window.grafica = new Chart(canvas, {
                type: 'horizontalBar',
                data: {
                    labels: ["hola",],
                    datasets: [
                        {
                            label: "Preguntas",
                            backgroundColor: ['rgb(255, 99, 132)', 'rgb(0, 255, 0)', 'rgb(255, 99, 132)', 'rgb(128, 255, 0)', 'rgb(145,60, 255)', 'rgb(255, 255,80 )', 'rgb(255, 255, 128)', 'rgb(255, 99, 200)', 'rgb(20,179, 255)', 'rgb(20,179, 255)', 'rgb(20,179, 255)', 'rgb(20,179, 255)', 'rgb(20,179, 255)', 'rgb(20,179, 255)', 'rgb(20,179, 255)', 'rgb(20,179, 255)', 'rgb(20,179, 255)', 'rgb(20,179, 255)', 'rgb(20,179, 255)', 'rgb(20,179, 255)', 'rgb(20,179, 255)', 'rgb(180,255,200)', 'rgb(180,255, 200)', 'rgb(180,255, 200)',],
                            borderColor: window.chartColors.red,
                            data: [5],
                        },



                    ]
                }
            })

    </script>
    <br />


}




@section Scripts {



}

